<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Póster 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: url('../Imagenes/fondoposters.png') no-repeat center center fixed;
      background-size: cover;
      overflow: hidden;
      touch-action: none;
    }

    .boton-retroceder, .boton-home {
      position: fixed;
      width: 120px;
      height: 130px;
      font-size: 2.5em;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      z-index: 20;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
    }

    .boton-retroceder { top: 60px; left: 50px; }
    .boton-home { top: 70px; right: 80px; }

    .container {
      margin-top: 220px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: calc(100vh - 200px);
      overflow: hidden;
    }

    .poster-imagen {
      max-width: 100vw;
      max-height: 80vh;
      border: 4px solid white;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      object-fit: contain;
      transition: transform 0.2s ease;
      touch-action: none;
      cursor: grab;
    }
  </style>
</head>

<body>
  <button class="boton-retroceder" onclick="window.location.href='../posters.html'">←</button>
  <button class="boton-home" onclick="window.location.href='../index.html'">⌂</button>

  <div class="container">
    <img id="poster" class="poster-imagen" src="../Imagenes/poster01.png" alt="Póster 1">
  </div>

  <script>
    const img = document.getElementById('poster');
    let scale = 1, originX = 50, originY = 50;
    let lastTap = 0, zoomEnabled = true;
    let isDragging = false, dragStartX = 0, dragStartY = 0, currentX = 0, currentY = 0;
    let pinchStartDist = 0, pinchStartScale = 1;
    let gallerySwipeEnabled = true;

    // Bloquear click derecho y arrastrar imagen
    document.addEventListener('contextmenu', e => e.preventDefault());
    img.addEventListener('dragstart', e => e.preventDefault());

    function updateZoom() {
      const container = img.parentElement.getBoundingClientRect();
      const scaledWidth = img.naturalWidth * scale;
      const scaledHeight = img.naturalHeight * scale;
      const maxX = Math.max((scaledWidth - container.width) / 2, 0);
      const maxY = Math.max((scaledHeight - container.height) / 2, 0);
      currentX = Math.min(maxX, Math.max(-maxX, currentX));
      currentY = Math.min(maxY, Math.max(-maxY, currentY));
      img.style.transformOrigin = `${originX}% ${originY}%`;
      img.style.transform = `translate(${currentX}px, ${currentY}px) scale(${scale})`;
    }

    function resetZoom() {
      scale = 1; originX = 50; originY = 50; currentX = 0; currentY = 0;
      gallerySwipeEnabled = true; // reactivar swipe
      updateZoom();
    }

    function zoomAt(x, y, zoomFactor) {
      const rect = img.getBoundingClientRect();
      originX = ((x - rect.left) / rect.width) * 100;
      originY = ((y - rect.top) / rect.height) * 100;
      scale = zoomFactor; updateZoom();
    }

    function handleDoubleTap(x, y) {
      if (!zoomEnabled) return;
      if (scale === 1) {
        scale = 2;
        gallerySwipeEnabled = false;
        zoomAt(x, y, scale);
      } else {
        resetZoom();
      }
    }

    img.onclick = e => {
      const now = Date.now();
      if (now - lastTap < 300) handleDoubleTap(e.clientX, e.clientY);
      lastTap = now;
    };

    img.onwheel = e => {
      if (!zoomEnabled) return;
      e.preventDefault();
      scale += e.deltaY > 0 ? -0.1 : 0.1;
      scale = Math.max(1, Math.min(3, scale));
      if (scale === 1) resetZoom();
      else {
        gallerySwipeEnabled = false;
        updateZoom();
      }
    };

    function startDrag(x, y) {
      if (scale === 1) return;
      isDragging = true;
      gallerySwipeEnabled = false;
      dragStartX = x; dragStartY = y;
      img.style.cursor = "grabbing";
    }
    function moveDrag(x, y) {
      if (!isDragging) return;
      currentX += x - dragStartX; currentY += y - dragStartY;
      dragStartX = x; dragStartY = y; updateZoom();
    }
    function endDrag() { isDragging = false; img.style.cursor = "grab"; }

    img.onmousedown = e => startDrag(e.clientX, e.clientY);
    img.onmousemove = e => moveDrag(e.clientX, e.clientY);
    img.onmouseup = endDrag;
    img.onmouseleave = endDrag;

    img.ontouchstart = e => {
      if (e.touches.length === 1) {
        startDrag(e.touches[0].clientX, e.touches[0].clientY);
      } else if (e.touches.length === 2) {
        pinchStartDist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        pinchStartScale = scale;
        gallerySwipeEnabled = false;
      }
    };

    img.ontouchmove = e => {
      if (e.touches.length === 1 && isDragging) {
        moveDrag(e.touches[0].clientX, e.touches[0].clientY);
      } else if (e.touches.length === 2) {
        const dist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        const zoomFactor = dist / pinchStartDist;
        scale = Math.max(1, Math.min(3, pinchStartScale * zoomFactor));
        updateZoom();
      }
    };

    img.ontouchend = e => {
      if (scale === 1) resetZoom();
      endDrag();
    };

    // Swipe lateral de galería (solo si no hay zoom)
    let touchStartX = 0;
    document.addEventListener('touchstart', e => {
      if (e.touches.length === 1) touchStartX = e.touches[0].clientX;
    });
    document.addEventListener('touchend', e => {
      if (!gallerySwipeEnabled) return;
      if (e.changedTouches.length === 1) {
        const deltaX = e.changedTouches[0].clientX - touchStartX;
        if (deltaX > 50) window.location.href = 'poster3.html';
        else if (deltaX < -50) window.location.href = 'poster2.html';
      }
    });

    // Inactividad → volver al inicio
    let timeout, redirectAfter = 60000;
    function resetInactivityTimer() {
      clearTimeout(timeout);
      timeout = setTimeout(() => window.location.href = '../index.html', redirectAfter);
    }
    ['mousemove','mousedown','keypress','touchstart','scroll']
      .forEach(evt => document.addEventListener(evt, resetInactivityTimer, { passive: true }));
    resetInactivityTimer();

    resetZoom();
  </script>
</body>
</html>
