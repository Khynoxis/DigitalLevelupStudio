<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>P√≥ster 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: url('../Imagenes/fondoposters.png') no-repeat center center fixed;
      background-size: cover;
      overflow: hidden;
      touch-action: none;
    }

    /* Botones de navegaci√≥n */
    .boton-retroceder, .boton-home {
      position: fixed;
      width: 120px;
      height: 130px;
      font-size: 2.5em;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      z-index: 20;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
    }

    .boton-retroceder { top: 60px; left: 50px; }
    .boton-home { top: 70px; right: 80px; }

    /* Contenedor del p√≥ster */
    .container {
      margin-top: 220px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: calc(100vh - 200px);
      overflow: hidden;
    }

    /* Imagen del p√≥ster */
    .poster-imagen {
      max-width: 100vw;
      max-height: 80vh;
      border: 4px solid white;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      object-fit: contain;
      transition: transform 0.2s ease;
      touch-action: none;
      cursor: grab;
    }
  </style>
</head>

<body>
  <!-- Botones -->
  <button class="boton-retroceder" onclick="window.location.href='../posters.html'">‚Üê</button>
  <button class="boton-home" onclick="window.location.href='../index.html'">‚åÇ</button>

  <!-- Contenedor principal -->
  <div class="container">
    <img id="poster" class="poster-imagen" src="../Imagenes/poster01.png" alt="P√≥ster 1">
  </div>

  <script>
    const img = document.getElementById('poster');
    let scale = 1, originX = 50, originY = 50;
    let lastTap = 0, zoomEnabled = true;
    let isDragging = false, dragStartX = 0, dragStartY = 0, currentX = 0, currentY = 0;
    let isZoomingOrDragging = false; // üö© NUEVA bandera

    /** Actualiza posici√≥n y escala */
    function updateZoom() {
      const container = img.parentElement.getBoundingClientRect();
      const scaledWidth = img.clientWidth * scale;
      const scaledHeight = img.clientHeight * scale;
      const maxX = Math.max((scaledWidth - container.width) / 2, 0);
      const maxY = Math.max((scaledHeight - container.height) / 2, 0);
      currentX = Math.min(maxX, Math.max(-maxX, currentX));
      currentY = Math.min(maxY, Math.max(-maxY, currentY));
      img.style.transformOrigin = `${originX}% ${originY}%`;
      img.style.transform = `scale(${scale}) translate(${currentX}px, ${currentY}px)`;

      // Si hay zoom o arrastre, activar bloqueo de swipe
      isZoomingOrDragging = (scale > 1) || isDragging;
    }

    /** Restablecer zoom */
    function resetZoom() {
      scale = 1; originX = 50; originY = 50; currentX = 0; currentY = 0;
      isZoomingOrDragging = false;
      updateZoom();
    }

    /** Zoom en posici√≥n */
    function zoomAt(x, y, zoomFactor) {
      const rect = img.getBoundingClientRect();
      originX = ((x - rect.left) / rect.width) * 100;
      originY = ((y - rect.top) / rect.height) * 100;
      scale = zoomFactor; currentX = 0; currentY = 0; updateZoom();
    }

    /** Doble clic / toque para zoom */
    function handleDoubleTap(x, y) {
      if (!zoomEnabled) return;
      scale = scale === 1 ? 2 : 1;
      zoomAt(x, y, scale);
    }

    img.onclick = e => {
      const now = Date.now();
      if (now - lastTap < 300) handleDoubleTap(e.clientX, e.clientY);
      lastTap = now;
    };

    img.ontouchend = e => {
      const now = Date.now();
      if (now - lastTap < 300 && e.changedTouches.length === 1) {
        const t = e.changedTouches[0];
        handleDoubleTap(t.clientX, t.clientY);
      }
      lastTap = now;
    };

    img.onwheel = e => {
      if (!zoomEnabled) return;
      e.preventDefault();
      scale += e.deltaY > 0 ? -0.1 : 0.1;
      scale = Math.max(1, Math.min(3, scale));
      updateZoom();
    };

    /** Arrastre con mouse y t√°ctil */
    function startDrag(x, y) {
      if (scale === 1) return;
      isDragging = true; dragStartX = x; dragStartY = y;
      img.style.cursor = "grabbing";
      isZoomingOrDragging = true; // Bloquear swipe
    }
    function moveDrag(x, y) {
      if (!isDragging) return;
      currentX += x - dragStartX; currentY += y - dragStartY;
      dragStartX = x; dragStartY = y; updateZoom();
    }
    function endDrag() {
      isDragging = false; img.style.cursor = "grab";
      isZoomingOrDragging = (scale > 1); // Mantener bloqueo si a√∫n hay zoom
    }

    img.onmousedown = e => startDrag(e.clientX, e.clientY);
    img.onmousemove = e => moveDrag(e.clientX, e.clientY);
    img.onmouseup = endDrag;
    img.onmouseleave = endDrag;
    img.ontouchstart = e => { if (e.touches.length === 1) startDrag(e.touches[0].clientX, e.touches[0].clientY); };
    img.ontouchmove = e => { if (e.touches.length === 1) moveDrag(e.touches[0].clientX, e.touches[0].clientY); };
    img.ontouchend = endDrag;

    /** Swipe lateral (bloqueado si hay zoom/arrastre) */
    let touchStartX = 0;
    document.addEventListener('touchstart', e => { if (e.touches.length === 1) touchStartX = e.touches[0].clientX; });
    document.addEventListener('touchend', e => {
      if (isZoomingOrDragging) return; // üö´ Bloquea galer√≠a
      if (e.changedTouches.length === 1) {
        const deltaX = e.changedTouches[0].clientX - touchStartX;
        if (deltaX > 50) window.location.href = 'poster3.html';
        else if (deltaX < -50) window.location.href = 'poster2.html';
      }
    });

    /** Inactividad */
    let timeout, redirectAfter = 60000;
    function resetInactivityTimer() {
      clearTimeout(timeout);
      timeout = setTimeout(() => window.location.href = '../index.html', redirectAfter);
    }
    ['mousemove','mousedown','keypress','touchstart','scroll']
      .forEach(evt => document.addEventListener(evt, resetInactivityTimer, { passive: true }));
    resetInactivityTimer();

    resetZoom();
  </script>
</body>
</html>
